# include "../io/io.h"
we need this becuase all disks are seen as block devies and we need to use io for sending and recieving data,so we neeed to write it conveiniently in bytes , words and dwords
# include "disk.h"
this file basically contains the implementation of our prototypes
# include "../essentials/essentials.h"
for memeset
# include "../osconfig.h"
for all neccessary CONSTANTS
# include "../error.h"
for all error codes


struct disk disk1;	
	we only have a single file disk for this stage.

int read_sect_disk(uint32_t lba, uint32_t total, void* buf)
{
		//lba contains starting lba number to read form
		//total represents total number of blocks to read
		//buf points to address where this block inputed that has to be stored
		outb(0x1f6, 0xe0 | ((lba >> 24) & 0x0f)); //we fill the lower 4 bits with 24-27bits of lba and upper for bits with 0xe which denotes master
		outb(0x1f2,total);
		outb(0x1f3,(lba &0xff));	//lower one byte of lba to 0x1f0
		outb(0x1f4,((lba >> 8) & 0xff));	//bytes 8 to bytes 15 of lba
		outb(0x1f5,((lba >>16 ) & 0xff)); //bytes 16 to 23 of lba
		outb(0x1f7,0x20);
		uint16_t * ptr=(uint16_t*)buf;
		for(int i=0;i<total;i++)
		{
			char flg= inb(0x1f7);
			while((flg & 0x88)!=0x08)  //flg&0x88 ==0x08
				flg=inb(0x1f7);
				
			for(int k=0;k<256;k++,ptr++)
				*ptr= in16(0x1f0);
		}
		return 0;
}
void disk_search_and_init()
{
 here it is just a dummy function, just for searching and init, at this satge it does not do what it claims,it just initializes all bytes to 0 to the only disk it knows,and sets the type and size, type to say its a real device of size one sector
	memset(&disk1,0,sizeof(disk1));
	disk1.type=DISK_TYPE_REAL;	
	disk1.size=SECTOR_SIZE;
}

struct disk* disk_get(uint32_t index)
{
this is to obtain the address of a struct in a array of struct where we have a number of disk structs one after the other, at this stage we only have one entry, so any entry except zero returns NULL, if 0 we return address of disk1
	if(index!=0)
		return NULL;
	return &disk1;
}

int read_disk_block(struct disk* disk_p,uint32_t lba, uint32_t total, void* buf)
{
it reads a number of blocks from a starting lba, into a buffer, for a given disk, it is just read_sect_disk()byt we can choose a disk, it just spports disks 
	if(disk_p != &disk1)
		return -GEN32_EIO;
	return read_sect_disk(lba,total,buf);
}
